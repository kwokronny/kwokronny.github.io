var scene,renderer,camera,stats,container,mixer,clock,stage,actions,autoRotate=!1,rotate=0;function init(){var e=(container=document.querySelector(".bg-canvas")).getBoundingClientRect().width,t=container.getBoundingClientRect().height;(camera=new THREE.PerspectiveCamera(45,e/t,1,2e3)).position.set(0,2,16),clock=new THREE.Clock,scene=new THREE.Scene;const n=new THREE.HemisphereLight(15921906,15921906);n.position.set(0,50,0),scene.add(n),(stage=new THREE.Object3D).position.y=-4,scene.add(stage);const a=new THREE.DirectionalLight(16777215);a.position.set(0,30,0),a.castShadow=!0,a.shadow.camera.near=.1,a.shadow.camera.far=60,scene.add(a);const i=(new THREE.TextureLoader).load("/gltf/textures/grass.png");i.wrapS=i.wrapT=THREE.RepeatWrapping,i.repeat.set(4,4),i.anisotropy=16,i.encoding=THREE.sRGBEncoding;var o=new THREE.Mesh(new THREE.CylinderBufferGeometry(5,5,.1,32),new THREE.MeshLambertMaterial({map:i}));o.receiveShadow=!0,stage.add(o);o=new THREE.GLTFLoader;o.load("/gltf/pumpkin.gltf",function(e){e=e.scene;e.traverse(function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0)}),e.rotation.set(0,1,0),e.position.set(1,.1,-2.4);e.scale.set(.33,.33,.33),stage.add(e)}),o.load("/gltf/zombie.gltf",function(e){var t=e.scene;t.traverse(function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0)}),t.position.set(.6,0,2.5),t.scale.set(1.5,1.5,1.5),stage.add(t),mixer=new THREE.AnimationMixer(t),(actions={}).push_up=mixer.clipAction(e.animations[0]),actions.idle=mixer.clipAction(e.animations[1]),actions.walk=mixer.clipAction(e.animations[2]),actions.idle.play(),animate();e=container.querySelector(".loading");container.removeChild(e)}),(renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(e,t),renderer.outputEncoding=THREE.sRGBEncoding,renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,container.appendChild(renderer.domElement),onWindowResize(),window.addEventListener("resize",onWindowResize,!1)}function animate(){requestAnimationFrame(animate);var e=clock.getDelta();mixer.update(e),autoRotate&&(rotate+=.001,stage.rotation.y=rotate%360),render()}function onWindowResize(){var e=container.getBoundingClientRect().width,t=container.getBoundingClientRect().height;camera.aspect=e/t,window.innerWidth<=750?(camera.position.set(0,3,13),stage.position.y=1):(camera.position.set(0,2,16),stage.position.y=-2,stage.rotation.x=0),camera.updateProjectionMatrix(),renderer.setSize(e,t)}function render(){renderer.render(scene,camera)}init(),document.querySelectorAll(".bg-canvas .switch-action input").forEach(function(e){e.addEventListener("change",function(e){"checkbox"==e.target.type?autoRotate=!autoRotate:(Object.values(actions).forEach(function(e){e.stop()}),e=e.target.value,actions[e].play())})});