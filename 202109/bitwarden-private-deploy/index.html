<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>ç§æœ‰åŒ–éƒ¨ç½²Bitwardenå¯†ç ç®¡ç†æœåŠ¡ KwokRonny&#39;Blog</title><meta name="keywords" content="kwokronny, javascript, web, docker, golang, å…¨æ²¾å·¥ç¨‹å¸ˆ,docker,æœåŠ¡,docker, bitwarden, nginx, https, password, vault, æœåŠ¡, å¯†ç ç®¡ç†, é—®é¢˜, åå‘ä»£ç†, è¿ç»´, åˆ†äº«"><meta name="description" content="Bitwarden æ˜¯åŸºä½¬åˆå‘ç°å¹¶æ¨èçš„å¦ä¸€ä¸ªå¤šå¹³å°å¯†ç ç®¡ç†å·¥å…·ï¼Œå®˜æ–¹æä¾›å…è´¹çš„å­˜å‚¨æœåŠ¡ï¼Œæœ€èµçš„è¿˜æ˜¯æ”¯æŒå…è´¹çš„ç§æœ‰åŒ–éƒ¨ç½²ï¼ç”±äºå®˜æ–¹ç½‘ç«™å›½å†…è®¿é—®ä¸ç•…ğŸ˜­ï¼Œæ—¥å¸¸å°±ä¸æ–¹ä¾¿ä¸å®¶äººå…±ç”¨ï¼Œæ‰€ä»¥å°±åªå¥½å°†å…¶ç§æœ‰åŒ–éƒ¨ç½²è‡³è‡ªå·±çš„NASä¸Šå•¦ğŸ˜‰ã€‚ç§æœ‰ç¯å¢ƒå®¶ä¸­è‡ªå»º"><meta content="telephone=no" name="format-detection"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><link rel="stylesheet" href="/css/index.css"><link rel="dns-prefetch" href="https://kwokronny.top/"><link rel="dns-prefetch" href="https://unpkg.com/"><link rel="alternate" href="/atom.xml" title="KwokRonny Feed" type="application/atom+xml"><link rel="stylesheet" href="//at.alicdn.com/t/font_2236624_69rc9okdrcb.css"><link rel="stylesheet" href="https://unpkg.com/animate.css@4.1.1/animate.min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="header"><div class="nav-btn"><span class="lt"><i></i></span><span class="lb"><i></i></span></div><a href="/" class="logo">KwokRonny&#39;Blog</a><div class="nav"><div class="nav-item"><a class="hover" href="/archives"><i class="fa fa-archive"></i> æ–‡ç« </a></div><div class="nav-item"><a href="/categories" class="hover"><i class="fa fa-inbox"></i> åˆ†ç±»</a><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/"><i class="fa fa-folder-open"></i> å¼€æºé¡¹ç›®</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"><i class="fa fa-folder-open"></i> æŠ€æœ¯åˆ†äº«</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"><i class="fa fa-folder-open"></i> å‰ç«¯æŠ€æœ¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"><i class="fa fa-folder-open"></i> åç«¯æŠ€æœ¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4/"><i class="fa fa-folder-open"></i> æœåŠ¡è¿ç»´</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%88%86%E4%BA%AB/"><i class="fa fa-folder-open"></i> è½¯ä»¶åˆ†äº«</a></li></ul></div><div class="nav-item"><a href="/tags" class="hover"><i class="fa fa-tag"></i> æ ‡ç­¾</a><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag"><i class="fa fa-tag"></i> JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Three-js/" rel="tag"><i class="fa fa-tag"></i> Three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag"><i class="fa fa-tag"></i> Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuex/" rel="tag"><i class="fa fa-tag"></i> Vuex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag"><i class="fa fa-tag"></i> docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag"><i class="fa fa-tag"></i> golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag"><i class="fa fa-tag"></i> nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/parcel/" rel="tag"><i class="fa fa-tag"></i> parcel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stylus/" rel="tag"><i class="fa fa-tag"></i> stylus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag"><i class="fa fa-tag"></i> typescript</a></li></ul></div><div class="nav-item"><a href="/friend" class="hover"><i class="fa fa-mars"></i> ä¼™ä¼´ä»¬</a><div class="friend-link-list clearfix"><a class="friend" target="_blank" href="https://www.mokeyjay.com/"><img src="https://www.mokeyjay.com/headimg.png"><div class="info"><h3 class="text-clamp_1" title="è¶…èƒ½å°ç´« mokeyjay">è¶…èƒ½å°ç´« mokeyjay</h3><div class="text-clamp_1" title="Webå…¨æ²¾ // ä¸“ä¸šå­¦æ¸£ // è´°åˆºçŒ¿ // æ°¸è¿œè¿˜ä¸å®Œä¿¡ç”¨å¡">Webå…¨æ²¾ // ä¸“ä¸šå­¦æ¸£ // è´°åˆºçŒ¿ // æ°¸è¿œè¿˜ä¸å®Œä¿¡ç”¨å¡</div></div></a></div></div><div class="nav-item-link"><a href="/about" class="hover"><i class="fa fa-user"></i></a> <a target="_blank" rel="noopener" href="https://github.com/kwokronny" class="hover"><i class="fa fa-github-alt"></i></a> <a href="/atom.xml" class="hover"><i class="fa fa-rss-square"></i></a></div></div></div><div class="container-mask"></div><div class="bg-canvas"><div class="loading"><img src="/img/loading.svg"><div>3D Model Loading</div></div><div class="switch-action"><label class="hvr-push"><input type="checkbox" name="rotate"> <i class="iconfont icon-rotate3d"></i></label> <label class="hvr-push"><input type="radio" value="walk" checked="checked" name="action"> <i class="iconfont icon-walk"></i></label> <label class="hvr-push"><input type="radio" value="idle" name="action"> <i class="iconfont icon-idle"></i></label> <label class="hvr-push"><input type="radio" value="push_up" name="action"> <i class="iconfont icon-push_up"></i></label></div></div><div class="main-container"><div id="content-outer"><div id="content-inner"><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.4.0/styles/dracula.min.css"><div class="left-panel"><div class="article-menu panel"><h3>ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E7%8E%AF%E5%A2%83"><span class="toc-text">ç§æœ‰ç¯å¢ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-text">éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-bitwarden"><span class="toc-text">éƒ¨ç½² bitwarden</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-nginx"><span class="toc-text">éƒ¨ç½² nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%AF%81%E4%B9%A6"><span class="toc-text">ç”Ÿæˆè¯ä¹¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99nginx%E9%85%8D%E7%BD%AE"><span class="toc-text">ç¼–å†™nginxé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%B9%B6%E5%BA%94%E7%94%A8"><span class="toc-text">ç«¯å£è½¬å‘å¹¶åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6"><span class="toc-text">å®šæ—¶æ›´æ–°è¯ä¹¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-text">å…³é—­æ³¨å†ŒåŠŸèƒ½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E5%B0%8F%E5%9D%91"><span class="toc-text">é‡åˆ°çš„å°å‘</span></a></li></ol></div></div><article id="post"><h1 class="title">ç§æœ‰åŒ–éƒ¨ç½²Bitwardenå¯†ç ç®¡ç†æœåŠ¡</h1><small class="description"><span class="date"><i class="fa fa-calendar"></i> 2021å¹´09æœˆ20æ—¥</span> <span><i class="fa fa-inbox"></i> <a class="category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%88%86%E4%BA%AB/">è½¯ä»¶åˆ†äº«</a> </span><span><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/docker/" rel="tag">docker</a>, <a class="tag-link" href="/tags/%E6%9C%8D%E5%8A%A1/" rel="tag">æœåŠ¡</a></span></small><blockquote class="text-a_c">æœ¬ç«™æ–‡ç« é™¤æ³¨æ˜è½¬è½½å¤–ï¼Œå‡ä¸ºåŸåˆ›æ–‡ç« ã€‚å¦‚éœ€è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼š<br><a href="https://kwokronny.top/202109/bitwarden-private-deploy/">https://kwokronny.top/202109/bitwarden-private-deploy/</a></blockquote><img src="/202109/bitwarden-private-deploy/cover.png" class="" width="0" height="0"><p>Bitwarden æ˜¯åŸºä½¬åˆå‘ç°å¹¶æ¨èçš„å¦ä¸€ä¸ªå¤šå¹³å°å¯†ç ç®¡ç†å·¥å…·ï¼Œå®˜æ–¹æä¾›å…è´¹çš„å­˜å‚¨æœåŠ¡ï¼Œæœ€èµçš„è¿˜æ˜¯æ”¯æŒå…è´¹çš„ç§æœ‰åŒ–éƒ¨ç½²ï¼<br>ç”±äºå®˜æ–¹ç½‘ç«™å›½å†…è®¿é—®ä¸ç•…ğŸ˜­ï¼Œæ—¥å¸¸å°±ä¸æ–¹ä¾¿ä¸å®¶äººå…±ç”¨ï¼Œæ‰€ä»¥å°±åªå¥½å°†å…¶ç§æœ‰åŒ–éƒ¨ç½²è‡³è‡ªå·±çš„NASä¸Šå•¦ğŸ˜‰ã€‚</p><img src="/202109/bitwarden-private-deploy/preview.png" class=""><h2 id="ç§æœ‰ç¯å¢ƒ"><a href="#ç§æœ‰ç¯å¢ƒ" class="headerlink" title="ç§æœ‰ç¯å¢ƒ"></a>ç§æœ‰ç¯å¢ƒ</h2><ul><li>å®¶ä¸­è‡ªå»ºNASï¼Œç”³è¯·å…¬ç½‘IP</li><li>CentOS 7</li><li>Docker</li><li>è‡ªæœ‰åŸŸå</li></ul><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><blockquote><p>ç”±äºå¯†ç åº“çš„ç›¸å¯¹ç§å¯†æ€§ï¼Œæ‰€ä»¥ç«¯å£è‡ªç„¶ä¸ä¼šä½¿ç”¨å¸¸è§„ç«¯å£ï¼Œä¸”æš‚æ—¶ä»…æœ‰äº›æœåŠ¡éœ€è¦httpsçš„æ”¯æŒï¼Œéœ€è¦nginxçš„åå‘ä»£ç†å®Œæˆï¼Œæˆ‘è¿™è¾¹å°±éšæœºäº†ä¸ªç«¯å£ä½¿ç”¨ï¼Œå¸¸è§„ç«¯å£å°±ç•™ç»™æ—¥åå†…ç½‘æ¶è®¾æœåŠ¡ç»™å®¶äººä½¿ç”¨å§ã€‚</p></blockquote><ol><li><h3 id="éƒ¨ç½²-bitwarden"><a href="#éƒ¨ç½²-bitwarden" class="headerlink" title="éƒ¨ç½² bitwarden"></a>éƒ¨ç½² bitwarden</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker volume create bitwarden_data // åˆ›å»º bitwarden_data å·<br><br>docker run --name bitwarden \<br>-v bitwarden_data:/data \<br>-p 39434:80<br>--restart always <br>vaultwarden/server<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—® å®¿ä¸»IP:39434 å³å¯çœ‹åˆ° Bitwarden çš„æœåŠ¡</p></li><li><h3 id="éƒ¨ç½²-nginx"><a href="#éƒ¨ç½²-nginx" class="headerlink" title="éƒ¨ç½² nginx"></a>éƒ¨ç½² nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker run --name Nginx \<br>-v /etc/nginx:/etc/nginx \<br>-v /usr/share/nginx:/usr/share/nginx \<br>-p 39435:39435 \<br>nginx<br></code></pre></td></tr></table></figure></li><li><h3 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h3><p>ç”±äº Bitwarden éœ€è¦ HTTPS çš„æ”¯æŒæ‰å¯ä»¥åœ¨ chrome ç­‰æµè§ˆå™¨ä¸­åº”ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸ºè¿˜éœ€ä¸º Bitwarden æœåŠ¡åå‘ä»£ç†å¼€å¯ HTTPSã€‚æˆ‘ä»¬å½“ç„¶æ˜¯ä½¿ç”¨å…è´¹çš„ <a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/docs/">Letâ€™s Encrypt</a>ã€‚</p><p>è€Œè¯ä¹¦ç”Ÿæˆéœ€è¦éªŒè¯åŸŸåæ˜¯å¦ä¸ºä½ æŒæœ‰ï¼Œæä¾›äº†ä»¥ä¸‹è®¤è¯æ–¹å¼ï¼š</p><ul><li>åœ¨ <code>example.com</code> ä¸‹é…ç½® DNS è®°å½•</li><li>åœ¨ <code>https://example.com/</code> çš„å·²çŸ¥ URI ä¸‹æ”¾ç½®ä¸€ä¸ª HTTP èµ„æº</li></ul><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å½“ç„¶é€‰æ‹©é€šè¿‡é…ç½®DNSè®°å½•å®Œæˆè®¤è¯è·å–è¯ä¹¦å•¦ï¼Œå› ä¸ºç§æœ‰åŒ–çš„éƒ¨ç½²å˜›ï¼Œä¸€èˆ¬å°±ä¸æš´éœ²å¸¸è§„æ¥å£å•¦ã€‚</p><p>é€šè¿‡ docker è¿è¡Œ certbox å®Œæˆè¯ä¹¦è·å–è‡³ nginx æŒ‚è½½é…ç½®æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºçš„certå†…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir -p /etc/nginx/cert <br>docker run -it --rm --name certbot -v /etc/nginx/cert:/etc/letsencrypt certbot/certbot --manual --preferred-challenges dns certonly<br><span class="hljs-comment"># äº¤äº’å¼æé—®ï¼š</span><br><span class="hljs-comment"># è¯·è¾“å…¥ä½ æƒ³è®¤è¯çš„åŸŸåï¼ˆå¤šä¸ªåŸŸåé€šè¿‡é€—å·æˆ–ç©ºæ ¼åˆ†éš”ï¼‰ï¼ˆå–æ¶ˆè¾“å…¥ &#x27;c&#x27; ï¼‰</span><br>Please enter the domain name(s) you would like on your certificate (comma and/or space separated) (Enter <span class="hljs-string">&#x27;c&#x27;</span> to cancel): vault.example.com<br><span class="hljs-comment"># è¯·æ±‚è¯ä¹¦ï¼Œä¸º åŸŸå å¢åŠ  ä¸€æ¡ txt è®°å½•ï¼Œname ä¸º &quot;_acme-challenge.vault.example.com&quot; ï¼Œdata ä¸º &quot;qRbOGoLXA889-IplowmYFlT_dgHYTKya9RBW5l0B73Y&quot;</span><br><span class="hljs-comment"># å®Œæˆåå¯é€šè¿‡ä¸‹é¢æç¤ºçš„ googleéªŒè¯å·¥å…·é“¾æ¥ç›´æ¥éªŒè¯æ˜¯å¦è§£ææˆåŠŸï¼ŒéªŒè¯æˆåŠŸæŒ‰å›è½¦è®¤è¯å³å¯</span><br>Requesting a certificate <span class="hljs-keyword">for</span> vault.example.com<br>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>Please deploy a DNS TXT record under the name:<br><br>_acme-challenge.vault.example.com. <br><br>with the following value:<br><br>qRbOGoLXA889-IplowmYFlT_dgHYTKya9RBW5l0B73Y<br><br>Before continuing, verify the TXT record has been deployed. Depending on the DNS<br>provider, this may take some time, from a few seconds to multiple minutes. You can<br>check <span class="hljs-keyword">if</span> it has finished deploying with aid of online tools, such as the Google<br>Admin Toolbox: https://toolbox.googleapps.com/apps/dig/<span class="hljs-comment">#TXT/_acme-challenge.vault.example.com.</span><br>Look <span class="hljs-keyword">for</span> one or more bolded line(s) below the line \<span class="hljs-string">&#x27;;ANSWER\&#x27;</span>. It should show the<br>value(s) you\<span class="hljs-string">&#x27;ve just added.</span><br><span class="hljs-string"></span><br><span class="hljs-string">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="hljs-string">Press Enter to Continue</span><br><span class="hljs-string"># è¿˜æœ‰äº›äº¤äº’å¼å›ç­”å°±æ˜¯äº›æ˜¯å¦è®¢é˜…åŠæ˜¯å¦åŒæ„éµå®ˆåè®®çš„é—®ç­”å°±ä¸ªäººè‡ªè¡Œé€‰æ‹©äº†</span><br></code></pre></td></tr></table></figure></li><li><h3 id="ç¼–å†™nginxé…ç½®"><a href="#ç¼–å†™nginxé…ç½®" class="headerlink" title="ç¼–å†™nginxé…ç½®"></a>ç¼–å†™nginxé…ç½®</h3><p>æ–°å¢å¹¶ç¼–è¾‘ <code>vault.example.com.conf</code> é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/nginx/conf.d/vault.example.com.conf<br></code></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>vault.example.com.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">server&#123;<br>	listen 443 ssl http2;<br>	server_name vault.example.com;<br>	index index.html index.htm default.htm default.html;<br>	root /usr/share/nginx/www/vault.example.com;<br><br>	add_header Permissions-Policy <span class="hljs-string">&quot;geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()&quot;</span>;<br>	server_tokens off; <span class="hljs-comment"># ä¸æ˜¾ç¤ºnginxç‰ˆæœ¬ä¿¡æ¯</span><br><br>	ssl_certificate   	cert/live/vault.example.com/fullchain.pem;<br>	ssl_certificate_key     cert/live/vault.example.com/privkey.pem;<br>	ssl_protocols TLSv1.2 TLSv1.1 TLSv1;<br>	ssl_prefer_server_ciphers on;<br>	ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;<br>	ssl_ecdh_curve secp384r1;<br>	ssl_session_tickets off;<br><br>	<span class="hljs-comment"># OCSP stapling</span><br>	ssl_stapling on;<br>	ssl_stapling_verify on;<br><br>	location ^~ /3KD63sjY2dd85 &#123; <span class="hljs-comment"># æŒ‡å®šåˆ°è‡ªå·±å–œæ¬¢çš„éšæœºæ•°ä¸å­—æ¯çš„ç»„åˆä½œä¸ºå¯†ç åº“æœåŠ¡çš„å…¥å£ï¼Œå¢åŠ å…¶éšè”½æ€§</span><br>		proxy_set_header		Host <span class="hljs-variable">$host</span>;<br>		proxy_set_header		X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>		proxy_hide_header		X-Powered-By;<br>		proxy_hide_header		feature-policy;<br><br>		proxy_pass http://å®¿ä¸»IP:39434/; <span class="hljs-comment"># æŒ‡å‘bitwardenæœåŠ¡</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><h3 id="ç«¯å£è½¬å‘å¹¶åº”ç”¨"><a href="#ç«¯å£è½¬å‘å¹¶åº”ç”¨" class="headerlink" title="ç«¯å£è½¬å‘å¹¶åº”ç”¨"></a>ç«¯å£è½¬å‘å¹¶åº”ç”¨</h3><p>ç”±äºä¸ºå†…ç½‘çš„ NAS æœåŠ¡ï¼Œéƒ¨ç½²å®Œæˆåå½“ç„¶è¿˜éœ€è¦é€šè¿‡è·¯ç”±å™¨ç«¯å£è½¬å‘å°† nginx ä¸º bitwardenæœåŠ¡å®šçš„éšæœºç«¯å£åè½¬å‘è‡³å¤–ç½‘<br>è‡³äºåŸŸåå¦‚ä½•ä¸è·¯ç”±å™¨ç»‘å®šå¯æœç´¢åŠ¨æ€åŸŸåä¹‹ç±»çš„ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡ NAS å®šæ—¶è¯·æ±‚åŸŸåæ›´æ–°IPçš„ URL å®Œæˆã€‚</p><p>æµè§ˆå™¨è¾“å…¥ <a target="_blank" rel="noopener" href="https://vault.example.com/3KD63sjY2dd85/">https://vault.example.com/3KD63sjY2dd85/</a> ï¼Œè¿›å…¥æœåŠ¡</p><img src="/202109/bitwarden-private-deploy/login.jpg" class=""><p>åˆ°è¿™ä¸€æ­¥åŸºæœ¬å°±å¯ä»¥å®Œæˆæ³¨å†Œï¼Œå¯¼å…¥å¯†ç åº“å•¦ã€‚</p><p>åœ¨ APP åŠ å„å¹³å°åº”ç”¨ä¸Šï¼Œéƒ½å¯ä»¥æ‰¾åˆ°åœ¨å³ä¸Šè§’ç‚¹å‡»è®¾ç½®å›¾æ ‡çš„æŒ‰é’®ï¼Œè¾“å…¥æ‰˜ç®¡æœåŠ¡çš„ç½‘å€</p><img src="/202109/bitwarden-private-deploy/set_service.png" class=""></li><li><h3 id="å®šæ—¶æ›´æ–°è¯ä¹¦"><a href="#å®šæ—¶æ›´æ–°è¯ä¹¦" class="headerlink" title="å®šæ—¶æ›´æ–°è¯ä¹¦"></a>å®šæ—¶æ›´æ–°è¯ä¹¦</h3><p><a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/docs/">Letâ€™s Encrypt</a> è¯ä¹¦çš„æœ‰æ•ˆæœŸæ˜¯90å¤©ï¼Œéœ€è¦å®šæ—¶ä¸ºå…¶æ›´æ–°è¯ä¹¦ï¼Œæ‰€ä»¥ä¹Ÿå°±éœ€è¦ä¸ºå†™ä¸ªè„šæœ¬å®šæ—¶æ‰§è¡Œä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">touch renew.sh<br>chmod -x renew.sh<br>vi renew.sh<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘æ›´æ–°è„šæœ¬</p><figure class="highlight bash"><figcaption><span>renew.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>docker run -it --rm --name certbot -v /etc/nginx/cert/:/etc/letsencrypt certbot/certbot renew --webroot -w /etc/letsencrypt<br><span class="hljs-comment"># é€šè¿‡ä¹‹å‰ç”Ÿæˆè¯ä¹¦åç”Ÿæˆçš„renewæ–‡ä»¶å¤¹å†…çš„ä¿¡æ¯ï¼Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦</span><br>docker <span class="hljs-built_in">exec</span> -it Nginx nginx -s reload<br><span class="hljs-comment"># é‡å¯nginx</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç¼–è¾‘å®šæ—¶ä»»åŠ¡</span><br>crontab -e<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 0 1 * * ~/renew.sh &gt; ~/letsencrypt.log <span class="hljs-comment">#æ¯æœˆæ‰§è¡Œä¸€æ¬¡</span><br></code></pre></td></tr></table></figure></li><li><h3 id="å…³é—­æ³¨å†ŒåŠŸèƒ½"><a href="#å…³é—­æ³¨å†ŒåŠŸèƒ½" class="headerlink" title="å…³é—­æ³¨å†ŒåŠŸèƒ½"></a>å…³é—­æ³¨å†ŒåŠŸèƒ½</h3><p>ä¸ºè‡ªå·±å’Œå®¶äººéƒ½æ³¨å†Œå¸å·åï¼Œä¿è¯å®‰å…¨æ€§ï¼Œå°±å…³é—­å¯†ç åº“çš„æ³¨å†ŒåŠŸèƒ½å•¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker stop bitwarden <br><br>docker run --name bitwarden \<br>-v bitwarden_data:/data \<br>-p 39434:80<br>-e SIGNUP_ALLOWED=<span class="hljs-literal">false</span><br>--restart always <br>vaultwarden/server<br></code></pre></td></tr></table></figure></li></ol><h2 id="é‡åˆ°çš„å°å‘"><a href="#é‡åˆ°çš„å°å‘" class="headerlink" title="é‡åˆ°çš„å°å‘"></a>é‡åˆ°çš„å°å‘</h2><p>é€šè¿‡nginxç®€å•çš„é…ç½®ï¼ŒHTTPSçš„æ ‡è¯†ä¾æ—§ä¸ºçº¢è‰²é”ï¼Œè¡¨ç¤ºç€ä¸å®‰å…¨ï¼Œè™½è¯´å·²ä¸å½±å“ä½¿ç”¨äº†ï¼›ä½†å¼ºè¿«ç—‡çš„æˆ‘è¿˜æ˜¯æ‰¾äº†ä¸‹ä¸ºä»€ä¹ˆã€‚<br>ç»§è€Œå‘ç°äº†ä¸ªæ£€æµ‹ HTTPS è®¤è¯çŠ¶æ€çš„ç½‘ç«™ï¼š<br><a target="_blank" rel="noopener" href="https://securityheaders.com/">SecurityHeaders</a><br>å‘ç°æ˜¯å°‘äº†ä¸€äº›Headerå±æ€§ä»¥åŠéƒ¨åˆ†å±æ€§å·²ä¸å®‰å…¨ç­‰<br>æ ¹æ® Missing Header å»è°·æ­Œå¿…åº”æœç´¢æ·»åŠ ä¸Šå³å¯</p><p>åœ¨æœç´¢çš„è¿‡ç¨‹ä¸­å‘ç°äº†ä¸‹åˆ—æ–‡ç« ï¼Œåˆšå¥½æ•™ä½  Apache å’Œ Nginx å¦‚ä½•é…ç½®å®‰å…¨å¤´éƒ¨ä¿¡æ¯çš„æ–‡ç« ï¼Œå¯¹ç…§ä¸Šè¿°ç½‘ç«™å¯ä»¥å¿«é€Ÿå°†å¤´éƒ¨é…ç½®å®Œæˆ<br><a target="_blank" rel="noopener" href="https://webdock.io/en/docs/how-guides/security-guides/how-to-configure-security-headers-in-nginx-and-apache#7.-permissions-policy">Apache å’Œ Nginx å¦‚ä½•é…ç½®å®‰å…¨å¤´éƒ¨ä¿¡æ¯</a></p><blockquote><p>ç”±äºæˆ‘ä»…æ­¤æœåŠ¡éœ€è¦ HTTPS çš„æ”¯æŒï¼Œæ‰€ä»¥ä¸å¯ä»¥ä½¿ç”¨ HSTSï¼ˆå¼ºåˆ¶HTTPSï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å¯æ·»åŠ ä»¥ä¸‹å¤´éƒ¨ï¼š</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs conf">add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot; always;<br></code></pre></td></tr></table></figure><div class="donate-panel"><label><input type="checkbox"><i class="fa fa-qrcode"></i> æ‰“èµ</label> å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!<div class="donate-code"><img src="/img/wechat_pay.jpg"> <img src="/img/alipay.jpg"></div></div><script type="text/javascript">document.querySelector(".donate-panel input").addEventListener("change",function(){document.querySelector(".donate-code").classList.toggle("show")})</script><script id="KBComment" src="/kb-comment/client.js" token="4fdd2f13e213eb7a2243fa6cd987eb83" theme="dark" crossorigin="anonymous" async></script></article></div></div></div><div class="footer">Power by <a target="_blank" rel="noopener" href="http://hexo.io">hexo</a>. | 3D Model Thx SketchFab: <a target="_blank" rel="noopener" href="https://sketchfab.com/Blender3D">Blender3D</a>, <a target="_blank" rel="noopener" href="https://sketchfab.com/arexon">Arexon</a></div><script src="https://unpkg.com/tween.js@16.6.0/src/Tween.js"></script><script src="/js/three/three.min.js"></script><script src="/js/three/GLTFLoader.min.js"></script><script src="/js/minecraft.js"></script><script src="/js/index.js"></script></body></html>